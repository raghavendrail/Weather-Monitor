<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Monitoring Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }

        h1, h2 {
            text-align: center;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }

        .chart-container, .alerts-container, .trends-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin: 10px;
            width: 45%;
        }

        .alerts-container div, .trends-container div {
            margin: 5px 0;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #e8f4ff;
        }
    </style>
</head>
<body>
    <h1>Weather Monitoring Dashboard</h1>

    <div class="container">
        <!-- Weather Chart Section -->
        <div class="chart-container">
            <h2>Weather Trends</h2>
            <canvas id="weatherChart"></canvas>
        </div>

        <!-- Triggered Alerts Section -->
        <div class="alerts-container">
            <h2>Triggered Alerts</h2>
            <div id="alerts">No alerts yet.</div>
        </div>
    </div>

    <div class="container">
        <!-- Historical Trends Section -->
        <div class="trends-container">
            <h2>Historical Trends</h2>
            <div id="historicalTrends">Loading historical trends...</div>
        </div>
    </div>

    <script>
        async function fetchWeatherData() {
            try {
                const response = await fetch('/api/weather/reports');
                const data = await response.json();
                renderChart(data);
            } catch (error) {
                console.error('Error fetching weather data:', error);
            }
        }

        function renderChart(data) {
            const cities = data.map(item => item.city);
            const temperatures = data.map(item => item.temperature);

            const ctx = document.getElementById('weatherChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: cities,
                    datasets: [{
                        label: 'Temperature (°C)',
                        data: temperatures,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        fill: false,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    interaction: { mode: 'nearest', intersect: false },
                    scales: {
                        x: { title: { display: true, text: 'City' } },
                        y: { title: { display: true, text: 'Temperature (°C)' } }
                    }
                }
            });
        }

        async function fetchTriggeredAlerts() {
            try {
                const response = await fetch('/api/weather/triggered-alerts');
                const alerts = await response.json();

                const alertsContainer = document.getElementById('alerts');
                alertsContainer.innerHTML = ''; // Clear previous alerts
                alerts.forEach(alert => {
                    const alertElement = document.createElement('div');
                    alertElement.textContent = alert;
                    alertsContainer.appendChild(alertElement);
                });
            } catch (error) {
                console.error('Error fetching triggered alerts:', error);
            }
        }

        async function fetchHistoricalTrends() {
            try {
                const response = await fetch('/api/weather/historical-trends');
                const trends = await response.json();

                const trendsContainer = document.getElementById('historicalTrends');
                trendsContainer.innerHTML = ''; // Clear previous trends
                trends.forEach(trend => {
                    const trendElement = document.createElement('div');
                    trendElement.textContent = `City: ${trend.city}, Avg Temp: ${trend.averageTemperature}°C, Condition: ${trend.weatherCondition}`;
                    trendsContainer.appendChild(trendElement);
                });
            } catch (error) {
                console.error('Error fetching historical trends:', error);
            }
        }

        // Load data on page load
        fetchWeatherData();
        fetchTriggeredAlerts();
        fetchHistoricalTrends();
    </script>
</body>
</html>
